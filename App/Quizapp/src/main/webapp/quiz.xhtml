<?xml version='1.0' encoding='UTF-8'?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
  <title>Quiz</title>
  <h:outputText value="#{loginController.checkLogin()}"/>
</h:head>
<h:body>
  <h1>Quiz</h1>
  <p><h:outputText value="#{currentUser.user.getUserName()}"/></p>
  <h:form>
    <p><h:commandButton action="#{loginController.logout}" value="Ausloggen"/></p>
  </h:form>
  <h2>Neues Quiz erstellen</h2>
  <h:form>
    <h:messages globalOnly="true" style="color:red;" />

    <h:outputLabel for="category" value="Kategorie:" />
    <h:selectOneMenu id="category" value="#{quizBean.category}" converter="#{categoryConverter}">
      <f:selectItems value="#{quizBean.allCategories}" var="cat" itemLabel="#{cat.category}" itemValue="#{cat}" />
    </h:selectOneMenu>

    <p><h:outputLabel for="isMultiplayer" value="Mehrspielermodus aktivieren?" /></p>
    <h:selectOneRadio id="isMultiplayer" value="#{quizBean.isMultiplayer}">
      <f:selectItem itemValue="true" itemLabel="Ja" />
      <f:selectItem itemValue="false" itemLabel="Nein" />
      <f:ajax render="@form" />
    </h:selectOneRadio>
    
      <h:panelGroup rendered="#{quizBean.isMultiplayer}">
        <h:outputLabel for="maxPlayers" value="Spieleranzahl:" />
        <h:selectOneMenu id="maxPlayers" value="#{quizBean.maxPlayers}">
          <f:selectItem itemValue="2" itemLabel="2 Spieler" />
          <f:selectItem itemValue="4" itemLabel="4 Spieler" />
          <f:convertNumber integerOnly="true" />
        </h:selectOneMenu>
      </h:panelGroup>

    <p><h:commandButton value="Quiz erstellen" action="#{gameController.createGame}">
      <f:ajax execute="@form" render="gameWrapper" />
    </h:commandButton></p>
  </h:form>

  <h:panelGroup id="gameWrapper">
  <h2>Ausstehende Spiele</h2>
  <h:panelGroup rendered="#{empty gameController.pendingSingleplayerGames and 
                            empty gameController.pendingMultiplayerGames and 
                            empty gameController.waitingMultiplayerGamesWithoutUser and 
                            empty gameController.waitingMultiplayerGamesForUser}">
    <h3>Du hast keine ausstehenden Spiele</h3>
  </h:panelGroup>
  <h:panelGroup rendered="#{not empty gameController.pendingSingleplayerGames}">
    <h3>Einzelspieler Spiele</h3>

    <h:form>
      <h:dataTable value="#{gameController.pendingSingleplayerGames}" var="game">
        <h:column>
          <f:facet name="header">Game ID</f:facet>
          <h:outputText value="#{game.gameID}" />
        </h:column>

        <h:column>
          <f:facet name="header">Kategorie</f:facet>
          <h:outputText value="#{game.quiz.category.category}" />
        </h:column>

        <h:column>
          <f:facet name="header">Jetzt Spielen</f:facet>
          <h:commandButton value="Jetzt spielen" action="#{gameController.playGame(game)}" />
        </h:column>
      </h:dataTable>
    </h:form>
  </h:panelGroup>
  <h:panelGroup rendered="#{not empty gameController.pendingMultiplayerGames or 
                            not empty gameController.waitingMultiplayerGamesForUser}">
    <h3>Mehrspieler Spiele</h3>
  </h:panelGroup>
  <h:panelGroup rendered="#{not empty gameController.pendingMultiplayerGames}">
    <h4>Bereit zu spielen</h4>

    <h:form>
      <h:dataTable value="#{gameController.pendingMultiplayerGames}" var="game">
        <h:column>
          <f:facet name="header">Game ID</f:facet>
          <h:outputText value="#{game.gameID}" />
        </h:column>

        <h:column>
          <f:facet name="header">Kategorie</f:facet>
          <h:outputText value="#{game.quiz.category.category}" />
        </h:column>

        <h:column>
          <f:facet name="header">Jetzt Spielen</f:facet>
          <h:commandButton value="Jetzt spielen" action="#{gameController.playGame(game)}" />
        </h:column>
      </h:dataTable>
    </h:form>
  </h:panelGroup>
  <h:panelGroup rendered="#{not empty gameController.waitingMultiplayerGamesForUser}">
    <h4>Warten auf Spieler</h4>

    <h:form>
      <h:dataTable value="#{gameController.waitingMultiplayerGamesForUser}" var="game">
        <h:column>
          <f:facet name="header">Game ID</f:facet>
          <h:outputText value="#{game.gameID}" />
        </h:column>

        <h:column>
          <f:facet name="header">Kategorie</f:facet>
          <h:outputText value="#{game.quiz.category.category}" />
        </h:column>
      </h:dataTable>
    </h:form>
  </h:panelGroup>
  <h:panelGroup rendered="#{not empty gameController.waitingMultiplayerGamesWithoutUser}">
    <h3>Spiele denen du beitreten kannst</h3>

    <h:form>
      <h:dataTable value="#{gameController.waitingMultiplayerGamesWithoutUser}" var="game">
        <h:column>
          <f:facet name="header">Game ID</f:facet>
          <h:outputText value="#{game.gameID}" />
        </h:column>

        <h:column>
          <f:facet name="header">Kategorie</f:facet>
          <h:outputText value="#{game.quiz.category.category}" />
        </h:column>

        <h:column>
          <f:facet name="header">Jetzt beitreten</f:facet>
          <h:commandButton value="Jetzt beitreten" action="#{gameController.joinGame(game)}">
            <f:ajax render="gameWrapper" />
          </h:commandButton>
        </h:column>
      </h:dataTable>
    </h:form>
  </h:panelGroup>
</h:panelGroup>
</h:body>
</html>